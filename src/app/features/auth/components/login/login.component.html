<div class="min-h-screen flex flex-col items-center justify-center relative overflow-hidden"
     style="background: linear-gradient(135deg, #1D3557 0%, #457B9D 50%, #A8DADC 100%);">

  <!-- Elementos decorativos animados de fondo -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="floating-element absolute top-1/4 left-1/4 w-32 h-32 rounded-full blur-xl"
         style="background: rgba(224, 242, 241, 0.2); animation: float1 6s ease-in-out infinite;"></div>
    <div class="floating-element absolute top-3/4 right-1/4 w-24 h-24 rounded-full blur-lg"
         style="background: rgba(168, 218, 220, 0.3); animation: float2 8s ease-in-out infinite;"></div>
    <div class="floating-element absolute top-1/2 left-3/4 w-40 h-40 rounded-full blur-2xl"
         style="background: rgba(69, 123, 157, 0.1); animation: float3 10s ease-in-out infinite;"></div>
  </div>

  <div class="w-full max-w-md p-8 relative z-10 login-card"
       style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-radius: 24px; box-shadow: 0 25px 50px rgba(29, 53, 87, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.1); animation: slideInUp 0.8s ease-out;">

    <!-- Header con Logo -->
    <div class="flex flex-col items-center text-center mb-8 header-section">
      <div class="logo-container relative group mb-6">
        <!-- Anillo exterior animado -->
        <div class="absolute inset-0 w-20 h-20 rounded-full opacity-75 rotating-ring"
             style="background: linear-gradient(45deg, #457B9D, #A8DADC); animation: rotate 8s linear infinite;"></div>

        <!-- Logo principal -->
        <div class="relative w-20 h-20 rounded-full flex items-center justify-center shadow-xl main-logo"
             style="background: linear-gradient(135deg, #457B9D, #1D3557); transition: transform 0.3s ease;">
          <div class="w-10 h-10 border-3 border-white rounded-full relative">
            <div class="absolute top-1/2 left-1/2 w-3 h-3 bg-white rounded-full logo-dot"
                 style="transform: translate(-50%, -50%); animation: pulse 2s infinite;"></div>
          </div>
        </div>
      </div>

      <h1 class="text-3xl font-bold mb-1 tracking-tight" style="color: #1D3557;">Egas Tamayo</h1>
      <h2 class="text-xl font-medium mb-2" style="color: #457B9D;">& Asociados</h2>
      <p class="text-sm font-medium" style="color: #7D7D7D;">Contabilidad • Finanzas • Seguros</p>
    </div>

    <!-- Formulario de Login -->
    <div *ngIf="!showEmpresaSelection()" class="form-section">
      <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="space-y-6">

        <!-- Campo Usuario -->
        <div class="relative group input-group">
          <mat-form-field appearance="fill" class="w-full">
            <mat-label style="color: #457B9D;">Usuario</mat-label>
            <input
              matInput
              formControlName="nombreUsuario"
              placeholder="Ingrese su usuario"
              autocomplete="username"
              class="custom-input"
              style="color: #2E2E2E;">
            <mat-icon matSuffix class="input-icon" style="color: #7D7D7D; transition: color 0.3s ease;">person</mat-icon>
            <mat-error *ngIf="nombreUsuarioErrors" class="error-message">{{ nombreUsuarioErrors }}</mat-error>
          </mat-form-field>
        </div>

        <!-- Campo Contraseña -->
        <div class="relative group input-group">
          <mat-form-field appearance="fill" class="w-full">
            <mat-label style="color: #457B9D;">Contraseña</mat-label>
            <input
              matInput
              [type]="hidePassword() ? 'password' : 'text'"
              formControlName="contrasena"
              placeholder="Ingrese su contraseña"
              autocomplete="current-password"
              class="custom-input"
              style="color: #2E2E2E;">
            <mat-icon
              matSuffix
              (click)="togglePasswordVisibility()"
              class="password-toggle"
              style="color: #7D7D7D; cursor: pointer; transition: all 0.3s ease;">
              {{ hidePassword() ? 'visibility_off' : 'visibility' }}
            </mat-icon>
            <mat-error *ngIf="contrasenaErrors" class="error-message">{{ contrasenaErrors }}</mat-error>
          </mat-form-field>
        </div>

        <!-- Botón de Login -->
        <button
          mat-raised-button
          type="submit"
          class="w-full py-4 rounded-xl shadow-lg font-semibold flex items-center justify-center gap-3 relative overflow-hidden login-button"
          style="background: linear-gradient(135deg, #457B9D, #1D3557); color: white; transition: all 0.3s ease; border: none;"
          [disabled]="isLoading()">

          <!-- Efecto de brillo -->
          <div class="shine-effect absolute inset-0"
               style="background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent); transform: translateX(-100%); transition: transform 0.7s ease;"></div>

          <ng-container *ngIf="!isLoading(); else loadingTemplate">
            <mat-icon class="button-icon" style="transition: transform 0.3s ease;">login</mat-icon>
            <span>Iniciar Sesión</span>
          </ng-container>

          <ng-template #loadingTemplate>
            <div class="flex items-center gap-3">
              <mat-spinner diameter="20"></mat-spinner>
              <span class="loading-text">Verificando...</span>
            </div>
          </ng-template>
        </button>

      </form>
    </div>

    <!-- Selección de Empresa -->
    <div *ngIf="showEmpresaSelection()" class="space-y-6 company-section">
      <div class="text-center">
        <mat-icon class="text-5xl mb-4 company-icon" style="color: #457B9D; animation: bounce 2s infinite;">business</mat-icon>
        <h3 class="text-xl font-bold mb-2" style="color: #1D3557;">Selecciona tu empresa</h3>
        <p class="text-sm" style="color: #7D7D7D;">Elige la empresa con la que deseas trabajar</p>
      </div>

      <div class="space-y-3">
        <button
          *ngFor="let empresa of empresas(); let i = index"
          mat-stroked-button
          class="w-full flex items-center justify-between rounded-xl px-6 py-4 company-button"
          style="border: 2px solid #A8DADC; color: #1D3557; transition: all 0.3s ease; animation-delay: calc(var(--i) * 100ms); animation: fadeInLeft 0.5s ease-out both;"
          [style.--i]="i"
          (click)="onEmpresaSelect(empresa)">

          <div class="flex items-center gap-4">
            <mat-icon style="color: #457B9D; transition: transform 0.3s ease;">domain</mat-icon>
            <span class="font-medium">{{ empresa.nomempresa }}</span>
          </div>
          <mat-icon class="arrow-icon" style="color: #7D7D7D; transition: all 0.3s ease;">arrow_forward_ios</mat-icon>
        </button>
      </div>

      <button
        mat-button
        class="flex items-center gap-3 mx-auto back-button"
        style="color: #7D7D7D; transition: all 0.3s ease;"
        (click)="showEmpresaSelection.set(false)">
        <mat-icon class="back-icon" style="transition: transform 0.3s ease;">arrow_back</mat-icon>
        <span>Volver al login</span>
      </button>
    </div>
  </div>

  <!-- Footer -->
  <div class="mt-8 text-xs text-center footer-section" style="color: #D3D3D3; animation: fadeIn 1s ease-out 0.8s both;">
    <p>&copy; 2025 Egas Tamayo & Asociados. Todos los derechos reservados.</p>
  </div>
</div>
